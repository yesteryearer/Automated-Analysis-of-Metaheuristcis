FROM python:3.8.10

WORKDIR /app

COPY requirements.txt ./

RUN pip install --no-cache-dir -r requirements.txt

COPY . .

ARG POSTGRES_HOST
ARG POSTGRES_PORT
ARG POSTGRES_DB
ARG POSTGRES_USER
ARG POSTGRES_PASSWORD
ARG DOCKER_BACKEND_PORT

ENV POSTGRES_HOST=$POSTGRES_HOST
ENV POSTGRES_PORT=$POSTGRES_PORT
ENV POSTGRES_DB=$POSTGRES_DB
ENV POSTGRES_USER=$POSTGRES_USER
ENV POSTGRES_PASSWORD=$POSTGRES_PASSWORD
ENV DOCKER_BACKEND_PORT=$DOCKER_BACKEND_PORT
ENV PYTHONUNBUFFERED=1

EXPOSE ${DOCKER_BACKEND_PORT}

CMD gunicorn -b :${DOCKER_BACKEND_PORT} app.main:app
